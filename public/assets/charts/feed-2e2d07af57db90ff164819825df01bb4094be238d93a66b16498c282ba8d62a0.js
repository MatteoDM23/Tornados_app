function buildMap(){var e="https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime="+starttime+"&endtime="+endtime+"&limit="+limit;0!=typeof lat&&0!=lon&&(e+="&latitude="+lat+"&longitude="+lon+"&maxradiuskm="+radius),magnitude>0&&(e+="&minmagnitude="+magnitude),console.log(e),$.get(e,function(e){console.log(e);var t=[],a=e.features;$("#result-count").text("("+a.length+" results)"),$.each(a,function(e,a){var o={location:new google.maps.LatLng(a.geometry.coordinates[1],a.geometry.coordinates[0]),weight:a.properties.mag};t.push(o)});var o=new google.maps.LatLng(lat,lon),n=2;0!=typeof lat&&0!=lon&&(n=12,radius>200&&(n=radius/200)),map=new google.maps.Map(document.getElementById("feedMap"),{center:o,zoom:n,mapTypeId:"satellite"}),new google.maps.visualization.HeatmapLayer({data:t}).setMap(map)})}function formatDate(e){var t=e.getMonth()+1;return e.getFullYear()+"-"+(t<10?"0"+t:t)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())}function buildRangeSlider(){$("#magnitude").slider({slide:function(e,t){magnitude=t.value,$(".magnitude-label").text("min magnitude: "+t.value)},max:8})}var starttime="",endtime="",limit=200,lat=0,lon=0,radius=1e3,magnitude=0,today=new Date;todayFormatted=formatDate(today);var todayMinusFive=new Date(today.setDate(today.getDate()-5));minusFiveFormatted=formatDate(todayMinusFive),starttime=minusFiveFormatted,endtime=todayFormatted,-1==window.location.pathname.indexOf("time")&&$(document).ready(function(){buildMap(),buildRangeSlider();var e=document.getElementById("place-input"),t=new google.maps.places.Autocomplete(e);t.addListener("place_changed",function(){var e=t.getPlace();console.log(e),e.geometry&&(lat=e.geometry.location.lat(),lon=e.geometry.location.lng())}),$("#start-feed-search").click(function(){buildMap()})});